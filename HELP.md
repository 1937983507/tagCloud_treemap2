# TreeMap 标签云 - 用户手册

## 概述

最后更新时间：2025年11月28日

### 1. 项目定位

`tagCloud_treemap2` 面向 **路径语义分析** 与 **地名可视化** 场景，结合高德地图绘线、POI 数据筛选与多 Treemap/词云算法，实现 “绘制线路 → 精准筛选 → 一键生成标签云” 的闭环体验。系统特别强化 **TreeMap 剖分**、**路线关联分析** 与 **多参数联动调优**，适用于旅游线路讲解、交通走廊分析、教学演示等任务。

### 2. 产品亮点

- **路线感知 + TreeMap**：根据折线或规划路径自动识别途经城市，将景点权重映射至 7 种 TreeMap 布局或词云算法，突出城市覆盖与等级差异。
- **并行交互面板**：内容、字体、配色、布局、线条五大面板协同工作，调整项实时写入 Pinia Store 并刷新画布。
- **多终端导出**：支持 SVG、PNG、JPEG 导出，配合画布遮罩、缩放、截图，方便嵌入汇报或论文。

![首页示意](/img/首页.png "scale:60%")

---

## 快速上手

最后更新时间：2025年11月28日

1. **访问系统**：打开部署地址或本地 `npm run dev` 启动的页面，默认显示地图+工作区+标签云画布。
2. **绘制/规划路径**：在地图中手绘折线或设置起终点，系统会沿线路抽稀并识别途经城市。
3. **检查数据面板**：`内容` 面板会同步展示经过的城市、景点表格与路径指标。
4. **运行生成标签云**：切换至标签云面板，点击 “运行生成标签云”，可在右侧画布预览 TreeMap 结果。
5. **逐步调优**：依次进入字体、配色、布局、线条面板进行细节配置，所有改动实时回写画布。
6. **导出成果**：确认视觉效果后，使用画布工具栏导出 SVG/PNG，或复制为报告配图。

---

## 入门教程

最后更新时间：2025年11月28日

### 1. 线路绘制模块

系统基于 **AMap JSAPI 2.0**，在 `PoiMap` 中提供手绘折线、起终点导航、热力/散点切换、底图切换等能力。绘制完成后可点击 “运行路径分析” 抽稀节点并生成沿线城市序列；鼠标悬停可查看景点名称，高德工具条支持缩放、测距、回到中国视图。

![路径绘制](/img/start.png "scale:40%")

### 2. 数据管理与关联分析

`PoiContent` 组件包含 **城市表格、景点表格、关系图/统计卡片**。通过地图筛选或路径感知得到的城市会自动高亮，可在右上角使用 “切换所选 / 删除所选 / 显示所有记录” 控制样本集。表格支持即时编辑与 CSV 导入，适合替换行业数据。

![数据分析](/img/生成标签云.png "scale:55%")

### 3. TreeMap 布局面板

`LayoutPanel` 内置 Resquarify、Binary、Dice、Slice、Strip、Spiral、Pivot 7 种 Treemap 布局，并提供 d3-cloud 词云作为补充；可自定义父子节点排序、填充策略、标签显示方式。切换布局或修改权重字段后，右侧画布立即刷新。

![布局调节](/img/布局修改.png "scale:55%")

### 4. 字体面板

`TypefacePanel` 用于控制字号区间、字重映射、字体家族以及文本描边。支持按城市排名或自定义字段分级，亦可开启 “展示排名/通行时间” 将统计信息直接拼接到标签上。

![字体调节](/img/字体修改.png "scale:55%")

### 5. 配色面板

`ColorPanel` 提供背景、主题色、色带数量与分级方式（等距、分位数、自然断点、几何间隔、标准差）。Treemap 矩形和词云文字均可独立配置主色或渐变色，调色板自带示例预设。

![配色调节](/img/配色修改.png "scale:55%")

### 6. 线条与路线样式

`LinePanel` 控制路径线型（单色/按城市渐变/按方向渐变）、线宽、节点样式，可叠加箭头与跳跃动画，辅助讲解路线的方向性和停靠点。

![线路样式](/img/线条修改.png "scale:55%")

### 7. 生成与导出

`TagCloudCanvas` 在运行生成后会显示遮罩与 Loading，用于提示 TreeMap 计算状态。完成后可使用右上角工具：缩放、重置视图、导出 PNG/JPEG/SVG、复制画布尺寸。导出前建议在内容面板确认权重字段与城市顺序无误。

---

## 常见问题

最后更新时间：2025年11月28日

1. **地图渲染缓慢？** 建议关闭热力层、减少抽稀精度或缩放到适中级别；必要时在 `PoiMap.vue` 限制同时展示的 POI 数量。
2. **城市未被识别？** 检查路径是否跨越该城市多边形，可适当增加折线节点或在 `provinceAdjacency` 中补充省份映射。
3. **标签重叠或过密？** 在 `LayoutPanel` 中调整 Padding、排序规则，或在 `TypefacePanel` 增大字号差异/减少节点数。
4. **导出图片模糊？** 推荐使用 SVG 导出或在 PNG 导出时提升画布尺寸；浏览器截图前先按 `Ctrl +` 放大页面。

---

## 更新日志

最后更新时间：2025年11月28日

- **v2.0.0**：新增 Treemap 多布局、路线线条面板、Intro.js 引导、反馈系统。
- **v1.1.0**：完成路径感知与 POI 抽稀、Pinia 状态管理、画布导出功能。
- **v1.0.0**：发布包含地图绘制、基础标签云生成的首个版本。

---

## 相关下载

最后更新时间：2025年11月28日

- [概述/快速上手/入门教程（PDF 合集）](/doc/地名标签云-概述.pdf) *如需 Treemap 专用版，请联系项目维护者。*
- [示例数据：chinapoi.csv](/public/data/chinapoi.csv)
- [GeoJSON 行政区数据：shi.js](/public/data/shi.js)

---

## 视频专区

最后更新时间：2025年11月28日

- **路线标签云工作流讲解（筹备中）**：将展示绘线、筛选、生成、导出的完整流程。
- **Treemap 布局调优案例（筹备中）**：对比不同布局的呈现效果与适用场景。

更多演示视频完成后将第一时间更新在此区域。
